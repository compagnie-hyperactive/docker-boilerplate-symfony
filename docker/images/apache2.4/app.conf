<VirtualHost *:80>
    ServerName localhost

	<FilesMatch \.php$>
    	SetHandler "proxy:fcgi://${FPM_HOST}"
    </FilesMatch>

    DocumentRoot /var/www/html/public/
    DirectoryIndex index.php

    RewriteEngine on
    RewriteCond %{ENV:REDIRECT_STATUS} ^$
    RewriteRule ^index\.php(?:/(.*)|$) %{ENV:BASE}/$1 [R=301,L]

    # If the requested filename exists, simply serve it.
    # We only want to let Apache serve files and not directories.
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]

    # Rewrite all other queries to the front controller.
    RewriteRule ^ %{ENV:BASE}/index.php [L]

    <Directory /var/www/html/public/>
        Options All
        AllowOverride All
        Order allow,deny
        allow from all
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/app_error.log
    CustomLog ${APACHE_LOG_DIR}/app_access.log combined
</VirtualHost>